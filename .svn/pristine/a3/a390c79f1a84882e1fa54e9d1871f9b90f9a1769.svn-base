webpackJsonp([81],{INS3:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("E4LH"),o=(r("0xDb"),{data:function(){return{visible:!1,popuvisible:!1,dataForm:{userId:null,userName:null,email:null,tel:null,idCard:null,person:!1,sys:!0,orgId:null,deptId:null,expiryDate:null,busObjType:0,optAuth:0,roleId:null,orgName:null,roleName:null,deptName:null,busObjsDesc:null,optAuthDesc:null},accType:2,orgList:[],orgListTreeProps:{label:"orgName",children:"children"},checkedEqList:[],eqtypeList:[],checkedOptAuthList:[],optAuthList:[],roleTypes:[],deptList:[],deptloading:!1,deptDisabled:!0,roleloading:!1,roleDisabled:!0,dataRule:{userName:[{required:!0,message:"用户名不能为空",trigger:"blur"}],tel:[{required:!0,message:"手机号不能为空",trigger:"blur"},{validator:function(e,t,r){Object(a.c)(t)?r():r(new Error("手机号格式错误"))},trigger:"blur"}],orgName:[{required:!0,message:"组织机构不能为空",trigger:"change"}],deptId:[{required:!0,message:"所属部门不能为空",trigger:"blur"}],roleId:[{required:!0,message:"角色不能为空",trigger:"blur"}]}}},methods:{init:function(e){var t=this;this.dataForm.userId=e||0,this.checkedEqList=[],this.eqtypeList=[],this.checkedOptAuthList=[],this.optAuthList=[],this.visible=!0,this.$nextTick(function(){t.$refs.dataForm.resetFields(),t.dataForm.orgId=null,t.dataForm.orgName=null,t.dataForm.deptId=null,t.dataForm.busObjType=0,t.dataForm.optAuth=0,t.getCurnUserOptAuth(),t.getCurnUserBusObjs()}),this.dataForm.userId&&this.$http({url:this.$http.adornUrl("/sys/org/getCurnUserManSysOrgTree"),method:"get",params:this.$http.adornParams()}).then(function(e){var r=e.data;r&&0==r.code?(t.orgList=r.data,t.$nextTick(function(){t.orgListTreeSetCurrentNode()})):t.$message.error(r.msg)}).then(function(){t.$http({url:t.$http.adornUrl("/sys/user/info/"+t.dataForm.userId),method:"get",params:t.$http.adornParams()}).then(function(e){var r=e.data;if(r&&0===r.code){t.dataForm.userName=r.user.userName,t.dataForm.email=r.user.email,t.dataForm.tel=r.user.tel,t.dataForm.person=r.user.person,t.dataForm.sys=r.user.sys,t.dataForm.orgId=r.user.orgId,t.dataForm.deptId=r.user.deptId,t.dataForm.expiryDate=r.user.expiryDate,t.dataForm.busObjType=r.user.busObjType,t.dataForm.optAuth=r.user.optAuth,t.dataForm.idCard=r.user.idCard,t.dataForm.roleId=r.user.roleId,r.user.person&&(t.accType=1),r.user.sys&&(t.accType=2),t.orgListTreeSetCurrentNode();for(var a=0;a<r.optAuthList.length;a++)t.checkedOptAuthList.push(r.optAuthList[a].code);for(a=0;a<r.busObjsList.length;a++)t.checkedEqList.push(r.busObjsList[a].code)}})})},orgListTreeCurrentChangeHandle:function(e,t){this.popuvisible=!1,this.dataForm.orgId=e.orgId,this.dataForm.orgName=e.orgName,this.getBusObjsByOrgId(e.orgId),this.clearDeptName(),this.clearRoleName(),this.getDeptByOrgId(this.dataForm.orgId),this.getRoleList(this.dataForm.orgId)},orgListTreeSetCurrentNode:function(){this.dataForm.orgId&&(this.$refs.orgListTree.setCurrentKey(this.dataForm.orgId),this.dataForm.orgName=(this.$refs.orgListTree.getCurrentNode()||{}).orgName,this.getDeptByOrgId(this.dataForm.orgId),this.getRoleList(this.dataForm.orgId))},clearOrgName:function(){this.dataForm.orgId=null,this.dataForm.orgName=null},clearDeptName:function(){this.dataForm.deptId=null,this.deptList=[]},clearRoleName:function(){this.dataForm.roleId=null,this.roleTypes=[]},accTypeChangeHandler:function(e){"1"===e?(this.dataForm.person=!0,this.dataForm.sys=!1):"2"===e&&(this.dataForm.person=!1,this.dataForm.sys=!0)},dataFormSubmit:function(){var e=this,t=0;this.dataForm.busObjsDesc="";for(var r=0;r<this.checkedEqList.length;r++){t|=this.checkedEqList[r];for(var a=0;a<this.eqtypeList.length;a++){var o=this.eqtypeList[a];this.checkedEqList[r]===o.code&&(""===this.dataForm.busObjsDesc?this.dataForm.busObjsDesc+=o.codeName:this.dataForm.busObjsDesc+=","+o.codeName)}}this.dataForm.busObjType=t;var s=0;this.dataForm.optAuthDesc="";for(r=0;r<this.checkedOptAuthList.length;r++){s|=this.checkedOptAuthList[r];for(a=0;a<this.optAuthList.length;a++){o=this.optAuthList[a];this.checkedOptAuthList[r]===o.code&&(""===this.dataForm.optAuthDesc?this.dataForm.optAuthDesc+=o.codeName:this.dataForm.optAuthDesc+=","+o.codeName)}}this.dataForm.optAuth=s,this.$refs.dataForm.validate(function(t){t&&e.$http({url:e.$http.adornUrl("/sys/user/"+(e.dataForm.userId?"update":"save")),method:"post",data:e.$http.adornData({userId:e.dataForm.userId||void 0,userName:e.dataForm.userName,email:e.dataForm.email,tel:e.dataForm.tel,person:e.dataForm.person,sys:e.dataForm.sys,idCard:e.dataForm.idCard,orgId:e.dataForm.orgId,deptId:e.dataForm.deptId,expiryDate:e.dataForm.expiryDate,busObjType:e.dataForm.busObjType,optAuth:e.dataForm.optAuth,roleId:e.dataForm.roleId})}).then(function(t){var r=t.data;r&&0===r.code?e.$message({message:"操作成功",type:"success",duration:500,onClose:function(){e.visible=!1,e.dataForm.userId||(e.dataForm.userId=r.userId),e.roleSelChange(e.dataForm.roleId),e.deptSelChange(e.dataForm.deptId),e.$emit("refreshDataList",e.dataForm)}}):e.$message.error(r.msg)})})},getOrgTree:function(){var e=this;this.orgList.length>0||this.$http({url:this.$http.adornUrl("/sys/org/getCurnUserManSysOrgTree"),method:"get",params:this.$http.adornParams()}).then(function(t){var r=t.data;r&&0==r.code?(e.orgList=r.data,e.$nextTick(function(){e.orgListTreeSetCurrentNode()})):e.$message.error(r.msg)})},getBusObjsByOrgId:function(e){var t=this;this.$http({url:this.$http.adornUrl("/sys/org/busObjs/"+e),method:"get",params:this.$http.adornParams()}).then(function(e){var r=e.data;if(r&&0===r.code){t.eqtypeList=r.busObjsList;for(var a=[],o=0;o<t.checkedEqList.length;o++){for(var s=t.checkedEqList[o],d=!0,i=0;i<t.eqtypeList.length;i++){s===t.eqtypeList[i].code&&(d=!1)}d&&a.push(s)}for(var l=0;l<a.length;l++){var n=t.checkedEqList.indexOf(a[l]);n>-1&&t.checkedEqList.splice(n,1)}}})},getCurnUserBusObjs:function(){var e=this;this.$http({url:this.$http.adornUrl("/sys/org/busObjs/curnuser"),method:"get",params:this.$http.adornParams()}).then(function(t){var r=t.data;r&&0===r.code&&(e.eqtypeList=r.busObjsList,e.checkedEqList=[])})},getCurnUserOptAuth:function(){var e=this;this.$http({url:this.$http.adornUrl("/sys/user/optauth/curnuser"),method:"get",params:this.$http.adornParams()}).then(function(t){var r=t.data;r&&0===r.code&&(e.optAuthList=r.optAuth,e.dataForm.userId||(e.checkedOptAuthList=[1]))})},getDeptByOrgId:function(e){var t=this;this.deptloading=!0,this.$http({url:this.$http.adornUrl("/sys/deptinfo/getDeptByOrgId/"+e),method:"get",params:this.$http.adornParams()}).then(function(e){var r=e.data;t.deptloading=!1,t.deptDisabled=!1,r&&0===r.code&&(t.deptList=r.list)})},getRoleList:function(e){var t=this;this.roleloading=!0,this.$http({url:this.$http.adornUrl("/sys/roleinfo/getRoleByOrgId/"+e),method:"get",params:this.$http.adornParams({page:1,limit:2e3})}).then(function(e){var r=e.data;t.roleloading=!1,t.roleDisabled=!1,t.roleTypes=r})},roleSelChange:function(e){for(var t=this.roleTypes.length,r=0;r<t;r++)this.roleTypes[r].roleId===e&&(this.dataForm.roleName=this.roleTypes[r].roleName)},deptSelChange:function(e){for(var t=this.deptList.length,r=0;r<t;r++)this.deptList[r].deptId===e&&(this.dataForm.deptName=this.deptList[r].deptName)}}}),s={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:e.dataForm.userId?"修改":"新增","close-on-click-modal":!1,width:"60%",visible:e.visible,center:"center"},on:{"update:visible":function(t){e.visible=t}}},[r("el-form",{ref:"dataForm",attrs:{model:e.dataForm,rules:e.dataRule,inline:!0,"label-width":"100px"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.dataFormSubmit()}}},[r("el-form-item",{attrs:{label:"用户名",prop:"userName"}},[r("el-input",{attrs:{placeholder:"登录帐号"},model:{value:e.dataForm.userName,callback:function(t){e.$set(e.dataForm,"userName",t)},expression:"dataForm.userName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[r("el-input",{attrs:{placeholder:"邮箱"},model:{value:e.dataForm.email,callback:function(t){e.$set(e.dataForm,"email",t)},expression:"dataForm.email"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"手机号",prop:"tel"}},[r("el-input",{attrs:{placeholder:"手机号"},model:{value:e.dataForm.tel,callback:function(t){e.$set(e.dataForm,"tel",t)},expression:"dataForm.tel"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"身份证号",prop:"idCard"}},[r("el-input",{attrs:{placeholder:"身份证号"},model:{value:e.dataForm.idCard,callback:function(t){e.$set(e.dataForm,"idCard",t)},expression:"dataForm.idCard"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"账户类型"}},[r("el-radio-group",{on:{change:e.accTypeChangeHandler},model:{value:e.accType,callback:function(t){e.accType=t},expression:"accType"}},[r("el-radio-button",{attrs:{label:"1"}},[e._v("个人账户")]),e._v(" "),r("el-radio-button",{attrs:{label:"2"}},[e._v("系统账户")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"过期日期",prop:"expiryDate"}},[r("el-date-picker",{attrs:{type:"date",placeholder:"过期日期","value-format":"yyyy-MM-dd"},model:{value:e.dataForm.expiryDate,callback:function(t){e.$set(e.dataForm,"expiryDate",t)},expression:"dataForm.expiryDate"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"组织机构",prop:"orgName"}},[r("el-popover",{ref:"orgListPopover",attrs:{placement:"bottom-start",trigger:"click"},model:{value:e.popuvisible,callback:function(t){e.popuvisible=t},expression:"popuvisible"}},[r("el-tree",{ref:"orgListTree",attrs:{data:e.orgList,props:e.orgListTreeProps,"node-key":"orgId","default-expand-all":!0,"highlight-current":!0,"expand-on-click-node":!1},on:{"current-change":e.orgListTreeCurrentChangeHandle}})],1),e._v(" "),r("el-input",{directives:[{name:"popover",rawName:"v-popover:orgListPopover",arg:"orgListPopover"}],attrs:{placeholder:"所属组织机构",readonly:!0,clearable:""},on:{clear:e.clearOrgName,focus:e.getOrgTree},model:{value:e.dataForm.orgName,callback:function(t){e.$set(e.dataForm,"orgName",t)},expression:"dataForm.orgName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"所属部门",prop:"deptId"}},[r("el-select",{attrs:{loading:e.deptloading,disabled:e.deptDisabled,placeholder:"所属部门"},model:{value:e.dataForm.deptId,callback:function(t){e.$set(e.dataForm,"deptId",t)},expression:"dataForm.deptId"}},e._l(e.deptList,function(e){return r("el-option",{key:e.deptId,attrs:{label:e.deptName,value:e.deptId}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"角色",prop:"roleId"}},[r("el-select",{attrs:{loading:e.roleloading,disabled:e.roleDisabled,placeholder:"请选择角色"},model:{value:e.dataForm.roleId,callback:function(t){e.$set(e.dataForm,"roleId",t)},expression:"dataForm.roleId"}},e._l(e.roleTypes,function(e){return r("el-option",{key:e.roleId,attrs:{label:e.roleName,value:e.roleId}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"业务对象",prop:"busObjType"}},[r("el-checkbox-group",{model:{value:e.checkedEqList,callback:function(t){e.checkedEqList=t},expression:"checkedEqList"}},e._l(e.eqtypeList,function(t){return r("el-checkbox",{key:t.code,attrs:{label:t.code}},[e._v(e._s(t.codeName))])}))],1),e._v(" "),r("el-form-item",{attrs:{label:"操作权限",prop:"optAuth"}},[r("el-checkbox-group",{model:{value:e.checkedOptAuthList,callback:function(t){e.checkedOptAuthList=t},expression:"checkedOptAuthList"}},e._l(e.optAuthList,function(t){return r("el-checkbox",{key:t.code,attrs:{label:t.code}},[e._v(e._s(t.codeName))])}))],1)],1),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dataFormSubmit()}}},[e._v("确定")])],1)],1)},staticRenderFns:[]},d=r("46Yf")(o,s,!1,null,null,null);t.default=d.exports}});